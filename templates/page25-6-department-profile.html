<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Profile - HODs Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .excel-like-table {
            border-collapse: collapse;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .excel-like-table th,
        .excel-like-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        .excel-like-table th {
            background-color: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        .excel-like-table tr:nth-child(even) {
            background-color: #f7fafc;
        }
        .excel-like-table tr:hover {
            background-color: #ebf8ff;
        }
        .section-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .section-content {
            padding: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <img alt="Institute logo" class="mr-4" height="50" src="{{ url_for('static', filename='images/vishnu-logo.jpg') }}" width="50"/>
                <h1 class="text-2xl font-bold">Vishnu Institute Of Technology</h1>
                <h2>Bhimavaram, West Godavari District</h2>
                <h2>Affiliated to JNTUK</h2>
                <h2>Accredited by NAAC 'A+'</h2>
                <h2>Approved by AICTE</h2>
            </div>
        </div>
    </header>

    <!-- Loading Spinner -->
    <div id="loading" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <p class="text-blue-600 font-semibold">Loading...</p>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="container mx-auto p-6">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">Department Profile Filters</h2>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                    <select id="departmentFilter" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="">Select Department</option>
                        <option value="AI & DS">AI & DS</option>
                        <option value="AI & ML">AI & ML</option>
                        <option value="BS">BS</option>
                        <option value="CSBS">CSBS</option>
                        <option value="CSE">CSE</option>
                        <option value="CE">CE</option>
                        <option value="ECE">ECE</option>
                        <option value="EEE">EEE</option>
                        <option value="IT">IT</option>
                        <option value="ME">ME</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Year of Students</label>
                    <select id="studentYearFilter" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="">All Years</option>
                        <option value="I">I</option>
                        <option value="II">II</option>
                        <option value="III">III</option>
                        <option value="IV">IV</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Year</label>
                    <select id="yearFilter" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="">All Years</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Month</label>
                    <select id="monthFilter" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="">All Months</option>
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 flex space-x-4">
                <button onclick="applyFilters()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700">Apply Filters</button>
                <button onclick="clearFilters()" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600">Clear Filters</button>
                <button onclick="exportPDF()" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700">Export PDF</button>
            </div>
        </div>
    </div>

    <!-- Department Data Sections -->
    <div class="container mx-auto p-6 space-y-6">
        
        <!-- Laboratory Purchases Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Laboratory Purchases</h3>
                <button onclick="exportTableToExcel('laboratory-list', 'laboratory_purchases')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Lab Name</th>
                                <th>Department</th>
                                <th>Equipment Name</th>
                                <th>Quantity</th>
                                <th>Cost</th>
                                <th>Purchase Date</th>
                                <th>Company Name</th>
                                <th>Specifications</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="laboratory-list">
                            <tr><td colspan="9" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Student Chapters Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Student Chapters</h3>
                <button onclick="exportTableToExcel('student-chapters-list', 'student_chapters')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Venue</th>
                                <th>Resource Person</th>
                                <th>College</th>
                                <th>Participant Count</th>
                                <th>Details</th>
                                <th>Departments</th>
                            </tr>
                        </thead>
                        <tbody id="student-chapters-list">
                            <tr><td colspan="9" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Higher Education Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Higher Education</h3>
                <button onclick="exportTableToExcel('higher-education-list', 'higher_education')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Register Number</th>
                                <th>Department</th>
                                <th>Exam Type</th>
                                <th>Exam Rank</th>
                                <th>Exam Score</th>
                                <th>Course</th>
                                <th>Admitted College</th>
                                <th>Location</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="higher-education-list">
                            <tr><td colspan="10" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Internship Opportunities Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Internship Opportunities</h3>
                <button onclick="exportTableToExcel('internship-list', 'internship_opportunities')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Register Number</th>
                                <th>Department</th>
                                <th>Allowed Year</th>
                                <th>Company Name</th>
                                <th>Company Details</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Duration</th>
                                <th>Designation</th>
                                <th>Stipend</th>
                                <th>Mode</th>
                                <th>Location</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="internship-list">
                            <tr><td colspan="14" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Alumni Cell Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Alumni Cell</h3>
                <button onclick="exportTableToExcel('alumni-list', 'alumni_cell')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Alumni Name</th>
                                <th>Talk Title</th>
                                <th>Event Date</th>
                                <th>Beneficiaries</th>
                                <th>Alumni Job</th>
                                <th>Alumni RegdNo</th>
                                <th>Company Details</th>
                                <th>Department</th>
                                <th>Participants</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="alumni-list">
                            <tr><td colspan="10" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- MOU Academia Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>MOU Academia</h3>
                <button onclick="exportTableToExcel('mou-list', 'mou_academia')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>University</th>
                                <th>Contact Person</th>
                                <th>Designation</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>MOU Period</th>
                                <th>Purpose</th>
                                <th>File Path</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="mou-list">
                            <tr><td colspan="9" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Guest Speakers Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Guest Speakers</h3>
                <button onclick="exportTableToExcel('guest-speakers-list', 'guest_speakers')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Designation</th>
                                <th>Visit Date</th>
                                <th>Purpose</th>
                                <th>Industry</th>
                                <th>Location</th>
                                <th>Remarks</th>
                                <th>Departments</th>
                            </tr>
                        </thead>
                        <tbody id="guest-speakers-list">
                            <tr><td colspan="8" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Industrial Visits Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Industrial Visits</h3>
                <button onclick="exportTableToExcel('industrial-visits-list', 'industrial_visits')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Industry Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Location</th>
                                <th>Beneficiaries</th>
                                <th>Total Students</th>
                                <th>Remarks</th>
                                <th>Departments</th>
                            </tr>
                        </thead>
                        <tbody id="industrial-visits-list">
                            <tr><td colspan="8" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- HRD/FDP/SDP Events Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>HRD/FDP/SDP Events</h3>
                <button onclick="exportTableToExcel('hrd-fdp-sdp-list', 'hrd_fdp_sdp_events')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Event Title</th>
                                <th>Event Type</th>
                                <th>Start Date</th>
                                <th>Start Time</th>
                                <th>End Date</th>
                                <th>End Time</th>
                                <th>Convener Name</th>
                                <th>Convener Phone</th>
                                <th>Coordinator Name</th>
                                <th>Coordinator Phone</th>
                                <th>Resource Person</th>
                                <th>Resource Person Designation</th>
                                <th>Resource Person CUO</th>
                                <th>Topic</th>
                                <th>Resource Person Details</th>
                                <th>Beneficiaries</th>
                                <th>Student Participants</th>
                                <th>Remarks</th>
                                <th>Departments</th>
                                <th>Branches</th>
                                <th>Years</th>
                            </tr>
                        </thead>
                        <tbody id="hrd-fdp-sdp-list">
                            <tr><td colspan="21" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Conferences Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Conferences</h3>
                <button onclick="exportTableToExcel('conferences-list', 'conferences')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Event Title</th>
                                <th>Conference URL</th>
                                <th>Start Date</th>
                                <th>Start Time</th>
                                <th>End Date</th>
                                <th>End Time</th>
                                <th>Convener Name</th>
                                <th>Convener Phone</th>
                                <th>Treasurer Name</th>
                                <th>Treasurer Phone</th>
                                <th>Papers Received</th>
                                <th>Papers Accepted</th>
                                <th>Indexing</th>
                                <th>Quartile Ranking</th>
                                <th>Contact Email</th>
                                <th>Contact Phone</th>
                                <th>Remarks</th>
                                <th>Brochure Path</th>
                                <th>Departments</th>
                            </tr>
                        </thead>
                        <tbody id="conferences-list">
                            <tr><td colspan="18" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Workshops/Seminars Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Workshops/Seminars</h3>
                <button onclick="exportTableToExcel('workshops-list', 'workshops')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>National/International</th>
                                <th>Event Type</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Topic</th>
                                <th>Beneficiaries</th>
                                <th>Student Participants</th>
                                <th>Remarks</th>
                                <th>Departments</th>
                                <th>Branches</th>
                                <th>Years</th>
                            </tr>
                        </thead>
                        <tbody id="workshops-list">
                            <tr><td colspan="12" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Hackathons Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Hackathons</h3>
                <button onclick="exportTableToExcel('hackathons-list', 'hackathons')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Hackathon Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Start Time</th>
                                <th>Campus Allowed</th>
                                <th>Team Limit</th>
                                <th>Prize Details</th>
                                <th>Winner Details</th>
                                <th>Runner Details</th>
                                <th>Second Runner Details</th>
                                <th>Remarks</th>
                                <th>Students Participated</th>
                                <th>Departments</th>
                                <th>Years Allowed</th>
                            </tr>
                        </thead>
                        <tbody id="hackathons-list">
                            <tr><td colspan="14" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- NSS Activities Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>NSS Activities</h3>
                <button onclick="exportTableToExcel('nss-list', 'nss_activities')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Activity Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Start Time</th>
                                <th>Purpose</th>
                                <th>Coordinator Details</th>
                                <th>Resource Person Details</th>
                                <th>Remarks</th>
                                <th>Students Participated</th>
                                <th>Years Allowed</th>
                            </tr>
                        </thead>
                        <tbody id="nss-list">
                            <tr><td colspan="10" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- IIC/IEDC/MSME Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>IIC/IEDC/MSME</h3>
                <button onclick="exportTableToExcel('iic-iedc-list', 'iic_iedc_msme')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Activity Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Students Participated</th>
                                <th>Organizer Details</th>
                                <th>Resource Person Details</th>
                                <th>Significance</th>
                                <th>Remarks</th>
                                <th>Conducted By</th>
                                <th>Years Allowed</th>
                            </tr>
                        </thead>
                        <tbody id="iic-iedc-list">
                            <tr><td colspan="10" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Engineers Day Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Engineers Day</h3>
                <button onclick="exportTableToExcel('engineers-day-list', 'engineers_day')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Event Date</th>
                                <th>Students Participated</th>
                                <th>Details</th>
                                <th>Brochure Path</th>
                                <th>Departments</th>
                                <th>Branches</th>
                                <th>Years Allowed</th>
                            </tr>
                        </thead>
                        <tbody id="engineers-day-list">
                            <tr><td colspan="8" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- IB Tech Activities Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>IB Tech Activities</h3>
                <button onclick="exportTableToExcel('ib-tech-list', 'ib_tech_activities')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Activity Name</th>
                                <th>Activity Type</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Coordinator Details</th>
                                <th>Resource Person Details</th>
                                <th>Students Participated</th>
                                <th>Remarks</th>
                                <th>Conducted Departments</th>
                            </tr>
                        </thead>
                        <tbody id="ib-tech-list">
                            <tr><td colspan="9" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Parents Meetings Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Parents Meetings</h3>
                <button onclick="exportTableToExcel('parents-meetings-list', 'parents_meetings')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Purpose</th>
                                <th>Meeting Date</th>
                                <th>Meeting Time</th>
                                <th>Venue</th>
                                <th>Coordinator Details</th>
                                <th>Parents Attended</th>
                                <th>Remarks</th>
                                <th>Conducted Departments</th>
                                <th>Years</th>
                            </tr>
                        </thead>
                        <tbody id="parents-meetings-list">
                            <tr><td colspan="9" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- R&D Events Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>R&D Events</h3>
                <button onclick="exportTableToExcel('rd-events-list', 'rd_events')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Event Date</th>
                                <th>Coordinator Details</th>
                                <th>Resource Person Details</th>
                                <th>Remarks</th>
                                <th>Students Participated</th>
                                <th>Brochure</th>
                                <th>Departments</th>
                                <th>Years Allowed</th>
                            </tr>
                        </thead>
                        <tbody id="rd-events-list">
                            <tr><td colspan="9" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Fest Events Section -->
        <div class="section-card">
            <div class="section-header flex justify-between items-center">
                <h3>Fest Events</h3>
                <button onclick="exportTableToExcel('fest-events-list', 'fest_events')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Export to Excel</button>
            </div>
            <div class="section-content">
                <div class="overflow-x-auto">
                    <table class="excel-like-table">
                        <thead>
                            <tr>
                                <th>Fest Name</th>
                                <th>Fest Date</th>
                                <th>Fest Type</th>
                                <th>Fest Significance</th>
                                <th>Coordinator Details</th>
                                <th>Resource Person Details</th>
                                <th>Remarks</th>
                                <th>Students Participated</th>
                                <th>Brochure</th>
                                <th>Departments</th>
                                <th>Student Years</th>
                            </tr>
                        </thead>
                        <tbody id="fest-events-list">
                            <tr><td colspan="11" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>

        function formatDateOnly(dateStr) {
            if (!dateStr) return 'N/A';
            const d = new Date(dateStr);
            if (isNaN(d)) return dateStr;
            return d.toLocaleDateString('en-GB', {
                weekday: 'short', year: 'numeric', month: 'short', day: '2-digit'
            });
        }

        // Function to export table data to Excel
        function exportTableToExcel(tableId, filename) {
            const table = document.getElementById(tableId);
            if (!table) {
                alert('Table not found!');
                return;
            }
            
            // Check if table has data (excluding rows with 'No data found' or similar messages)
            let hasData = false;
            let messageRow = false;
            
            // First check if we have any rows
            if (table.rows.length === 0) {
                alert('No data to export! Please apply filters first to load data.');
                return;
            }
            
            for (let i = 0; i < table.rows.length; i++) {
                const row = table.rows[i];
                if (row.cells.length === 0) continue;
                
                const firstCell = row.cells[0];
                if (!firstCell) continue;
                
                const colspan = firstCell.getAttribute('colspan');
                
                // Check if this is a message row
                if (colspan && parseInt(colspan) > 1 && 
                    (firstCell.textContent.includes('No data') || 
                     firstCell.textContent.includes('Select filters') || 
                     firstCell.textContent.includes('Error loading'))) {
                    messageRow = true;
                    continue;
                }
                
                // If we have a row with multiple cells or a single cell that's not a message
                if (row.cells.length > 1 || !messageRow) {
                    hasData = true;
                    break;
                }
            }
            
            if (!hasData) {
                alert('No data to export! Please apply filters first to load data.');
                return;
            }

            // Get the table headers
            const headerRow = table.parentElement.querySelector('thead tr');
            const headers = [];
            for (let i = 0; i < headerRow.cells.length; i++) {
                headers.push(headerRow.cells[i].innerText);
            }

            // Create worksheet data
            const wsData = [headers];

            // Add table data rows
            for (let i = 0; i < table.rows.length; i++) {
                const row = table.rows[i];
                // Skip empty state message row
                if (row.cells.length === 1 && row.cells[0].colSpan > 1) continue;
                
                const rowData = [];
                for (let j = 0; j < row.cells.length; j++) {
                    // Clean the cell text (remove any HTML)
                    const cellText = row.cells[j].innerText.trim();
                    rowData.push(cellText);
                }
                wsData.push(rowData);
            }

            // Create a worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);

            // Create a workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');

            // Generate Excel file and trigger download
            XLSX.writeFile(wb, filename + '.xlsx');
        }

        function applyFilters() {
            const department = document.getElementById('departmentFilter').value;
            const studentYear = document.getElementById('studentYearFilter').value;
            const year = document.getElementById('yearFilter').value;
            const month = document.getElementById('monthFilter').value;

            if (!department) {
                alert('Please select a department');
                return;
            }

            // Show loading
            document.getElementById('loading').classList.remove('hidden');

            // Fetch all data types
            const sectionsToFetch = [
                'laboratory', 'student-chapters', 'higher-education', 'internship',
                'alumni', 'mou', 'guest-speakers', 'industrial-visits', 'hrd-fdp-sdp',
                'conferences', 'workshops', 'hackathons', 'nss', 'iic-iedc',
                'engineers-day', 'ib-tech', 'parents-meetings', 'rd-events', 'fest-events'
            ];

            sectionsToFetch.forEach(section => {
                fetchSectionData(section, department, studentYear, year, month);
            });
        }

        function clearFilters() {
            document.getElementById('departmentFilter').value = '';
            document.getElementById('studentYearFilter').value = '';
            document.getElementById('yearFilter').value = '';
            document.getElementById('monthFilter').value = '';
            
            // Clear all tables
            const sectionsToClear = [
                'laboratory-list', 'student-chapters-list', 'higher-education-list', 'internship-list',
                'alumni-list', 'mou-list', 'guest-speakers-list', 'industrial-visits-list', 'hrd-fdp-sdp-list',
                'conferences-list', 'workshops-list', 'hackathons-list', 'nss-list', 'iic-iedc-list',
                'engineers-day-list', 'ib-tech-list', 'parents-meetings-list', 'rd-events-list', 'fest-events-list'
            ];

            sectionsToClear.forEach(sectionId => {
                const tbody = document.getElementById(sectionId);
                tbody.innerHTML = '<tr><td colspan="7" class="text-gray-500 text-center">Select filters and click Apply to view data</td></tr>';
            });
        }

        function fetchSectionData(section, department, studentYear, year, month) {
            const endpoints = {
                'laboratory': '/get_department_laboratory',
                'student-chapters': '/get_department_student_chapters',
                'higher-education': '/get_department_higher_education',
                'internship': '/get_department_internship',
                'alumni': '/get_department_alumni',
                'mou': '/get_department_mou',
                'guest-speakers': '/get_department_guest_speakers',
                'industrial-visits': '/get_department_industrial_visits',
                'hrd-fdp-sdp': '/get_department_hrd_fdp_sdp',
                'conferences': '/get_department_conferences',
                'workshops': '/get_department_workshops',
                'hackathons': '/get_department_hackathons',
                'nss': '/get_department_nss',
                'iic-iedc': '/get_department_iic_iedc',
                'engineers-day': '/get_department_engineers_day',
                'ib-tech': '/get_department_ib_tech',
                'parents-meetings': '/get_department_parents_meetings',
                'rd-events': '/get_department_rd_events',
                'fest-events': '/get_department_fest_events'
            };

            const tableIds = {
                'laboratory': 'laboratory-list',
                'student-chapters': 'student-chapters-list',
                'higher-education': 'higher-education-list',
                'internship': 'internship-list',
                'alumni': 'alumni-list',
                'mou': 'mou-list',
                'guest-speakers': 'guest-speakers-list',
                'industrial-visits': 'industrial-visits-list',
                'hrd-fdp-sdp': 'hrd-fdp-sdp-list',
                'conferences': 'conferences-list',
                'workshops': 'workshops-list',
                'hackathons': 'hackathons-list',
                'nss': 'nss-list',
                'iic-iedc': 'iic-iedc-list',
                'engineers-day': 'engineers-day-list',
                'ib-tech': 'ib-tech-list',
                'parents-meetings': 'parents-meetings-list',
                'rd-events': 'rd-events-list',
                'fest-events': 'fest-events-list'
            };

            const endpoint = endpoints[section];
            const tableId = tableIds[section];

            if (!endpoint || !tableId) return;

            let url = `${endpoint}?department=${encodeURIComponent(department)}`;
            if (studentYear) url += `&year=${encodeURIComponent(studentYear)}`;
            if (month) url += `&month=${encodeURIComponent(month)}`;

            console.log(`Fetching ${section} from: ${url}`);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log(`${section} data:`, data);
                    const tbody = document.getElementById(tableId);
                    tbody.innerHTML = '';

                    if (!Array.isArray(data) || data.length === 0) {
                        const colCount = getColumnCount(section);
                        tbody.innerHTML = `<tr><td colspan="${colCount}" class="text-gray-500 text-center">No data found</td></tr>`;
                        return;
                    }

                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = generateTableRowHtml(section, item);
                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error(`Error fetching ${section} data:`, error);
                    const tbody = document.getElementById(tableId);
                    const colCount = getColumnCount(section);
                    tbody.innerHTML = `<tr><td colspan="${colCount}" class="text-red-500 text-center">Error loading data</td></tr>`;
                })
                .finally(() => {
                    // Hide loading after all sections are processed
                    setTimeout(() => {
                        document.getElementById('loading').classList.add('hidden');
                    }, 500);
                });
        }

        function getColumnCount(section) {
            const columnCounts = {
                'laboratory': 9,
                'student-chapters': 9,
                'higher-education': 10,
                'internship': 14,
                'alumni': 10,
                'mou': 9,
                'guest-speakers': 8,
                'industrial-visits': 8,
                'hrd-fdp-sdp': 21,
                'conferences': 18,
                'workshops': 12,
                'hackathons': 14,
                'nss': 10,
                'iic-iedc': 10,
                'engineers-day': 8,
                'ib-tech': 7,
                'parents-meetings': 7,
                'rd-events': 7,
                'fest-events': 7
            };
            return columnCounts[section] || 7;
        }

        function generateTableRowHtml(section, item) {
            switch(section) {
                case 'laboratory':
                    return `
                        <td>${item.lab_name || 'N/A'}</td>
                        <td>${item.department || 'N/A'}</td>
                        <td>${item.equipment_name || 'N/A'}</td>
                        <td>${item.quantity || 'N/A'}</td>
                        <td>${item.cost || 'N/A'}</td>
                        <td>${formatDateOnly(item.purchase_date) || 'N/A'}</td>
                        <td>${item.company_name || 'N/A'}</td>
                        <td>${item.specifications || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                    `;
                case 'student-chapters':
                    return `
                        <td>${item.event_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.venue || 'N/A'}</td>
                        <td>${item.resource_person || 'N/A'}</td>
                        <td>${item.college || 'N/A'}</td>
                        <td>${item.participant_count || 'N/A'}</td>
                        <td>${item.details || 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                    `;
                case 'higher-education':
                    return `
                        <td>${item.student_name || 'N/A'}</td>
                        <td>${item.register_number || 'N/A'}</td>
                        <td>${item.department || 'N/A'}</td>
                        <td>${item.exam_type || 'N/A'}</td>
                        <td>${item.exam_rank || 'N/A'}</td>
                        <td>${item.exam_score || 'N/A'}</td>
                        <td>${item.course || 'N/A'}</td>
                        <td>${item.admitted_college || 'N/A'}</td>
                        <td>${item.location || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                    `;
                case 'internship':
                    return `
                        <td>${item.student_name || 'N/A'}</td>
                        <td>${item.register_number || 'N/A'}</td>
                        <td>${item.department || 'N/A'}</td>
                        <td>${item.allowed_year || 'N/A'}</td>
                        <td>${item.company_name || 'N/A'}</td>
                        <td>${item.company_details || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.duration || 'N/A'}</td>
                        <td>${item.designation || 'N/A'}</td>
                        <td>${item.stipend || 'N/A'}</td>
                        <td>${item.mode || 'N/A'}</td>
                        <td>${item.location || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                    `;
                case 'alumni':
                    return `
                        <td>${item.alumni_name || 'N/A'}</td>
                        <td>${item.talk_title || 'N/A'}</td>
                        <td>${formatDateOnly(item.event_date) || 'N/A'}</td>
                        <td>${item.beneficiaries || 'N/A'}</td>
                        <td>${item.alumni_job || 'N/A'}</td>
                        <td>${item.alumni_regdno || 'N/A'}</td>
                        <td>${item.company_details || 'N/A'}</td>
                        <td>${item.department || 'N/A'}</td>
                        <td>${item.participants || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                    `;
                case 'mou':
                    return `
                        <td>${item.university || 'N/A'}</td>
                        <td>${item.contact_person || 'N/A'}</td>
                        <td>${item.designation || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.mou_period || 'N/A'}</td>
                        <td>${item.purpose || 'N/A'}</td>
                        <td>${item.file_path ? `<a href="/uploads/${item.file_path.replace(/^uploads[\\/]/, '')}" target="_blank" class="text-blue-600 hover:underline">View File</a>` : 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                    `;
                case 'guest-speakers':
                    return `
                        <td>${item.name || 'N/A'}</td>
                        <td>${item.designation || 'N/A'}</td>
                        <td>${formatDateOnly(item.visit_date) || 'N/A'}</td>
                        <td>${item.purpose || 'N/A'}</td>
                        <td>${item.industry || 'N/A'}</td>
                        <td>${item.location || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                    `;
                case 'industrial-visits':
                    return `
                        <td>${item.industry_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.location || 'N/A'}</td>
                        <td>${item.beneficiaries || 'N/A'}</td>
                        <td>${item.total_students || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                    `;
                case 'hrd-fdp-sdp':
                    return `
                        <td>${item.event_title || 'N/A'}</td>
                        <td>${item.event_type || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${item.start_time || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.end_time || 'N/A'}</td>
                        <td>${item.convener_name || 'N/A'}</td>
                        <td>${item.convener_phone || 'N/A'}</td>
                        <td>${item.coordinator_name || 'N/A'}</td>
                        <td>${item.coordinator_phone || 'N/A'}</td>
                        <td>${item.resource_person || 'N/A'}</td>
                        <td>${item.resource_person_designation || 'N/A'}</td>
                        <td>${item.resource_person_cuo || 'N/A'}</td>
                        <td>${item.topic || 'N/A'}</td>
                        <td>${item.resource_person_details || 'N/A'}</td>
                        <td>${item.beneficiaries || 'N/A'}</td>
                        <td>${item.student_participants || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                        <td>${item.branches || 'N/A'}</td>
                        <td>${item.years || 'N/A'}</td>
                    `;
                case 'conferences':
                    return `
                        <td>${item.event_title || 'N/A'}</td>
                        <td>${item.conference_url || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${item.start_time || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.end_time || 'N/A'}</td>
                        <td>${item.convener_name || 'N/A'}</td>
                        <td>${item.convener_phone || 'N/A'}</td>
                        <td>${item.treasurer_name || 'N/A'}</td>
                        <td>${item.treasurer_phone || 'N/A'}</td>
                        <td>${item.papers_received || 'N/A'}</td>
                        <td>${item.papers_accepted || 'N/A'}</td>
                        <td>${item.indexing || 'N/A'}</td>
                        <td>${item.quartile_ranking || 'N/A'}</td>
                        <td>${item.contact_email || 'N/A'}</td>
                        <td>${item.contact_phone || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.brochure_path ? `<a href="/uploads/${item.brochure_path.replace(/^uploads[\\/]/, '')}" target="_blank" class="text-blue-600 hover:underline">View Brochure</a>` : 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                    `;
                case 'workshops':
                    return `
                        <td>${item.event_name || 'N/A'}</td>
                        <td>${item.national_international || 'N/A'}</td>
                        <td>${item.event_type || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.topic || 'N/A'}</td>
                        <td>${item.beneficiaries || 'N/A'}</td>
                        <td>${item.student_participants || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                        <td>${item.branches || 'N/A'}</td>
                        <td>${item.years || 'N/A'}</td>
                    `;
                case 'hackathons':
                    return `
                        <td>${item.hackathon_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.start_time || 'N/A'}</td>
                        <td>${item.campus_allowed || 'N/A'}</td>
                        <td>${item.team_limit || 'N/A'}</td>
                        <td>${item.prize_details || 'N/A'}</td>
                        <td>${item.winner_details || 'N/A'}</td>
                        <td>${item.runner_details || 'N/A'}</td>
                        <td>${item.second_runner_details || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                        <td>${item.years_allowed || 'N/A'}</td>
                    `;
                case 'nss':
                    return `
                        <td>${item.activity_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.start_time || 'N/A'}</td>
                        <td>${item.purpose || 'N/A'}</td>
                        <td>${item.coordinator_details || 'N/A'}</td>
                        <td>${item.resource_person_details || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.years_allowed || 'N/A'}</td>
                    `;
                case 'iic-iedc':
                    return `
                        <td>${item.activity_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.organizer_details || 'N/A'}</td>
                        <td>${item.resource_person_details || 'N/A'}</td>
                        <td>${item.significance || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.conducted_by || 'N/A'}</td>
                        <td>${item.years_allowed || 'N/A'}</td>
                    `;
                case 'engineers-day':
                    return `
                        <td>${item.event_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.event_date) || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.details || 'N/A'}</td>
                        <td>${item.brochure_path ? `<a href="/uploads/${item.brochure_path.replace(/^uploads[\\/]/, '')}" target="_blank" class="text-blue-600 hover:underline">View Brochure</a>` : 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                        <td>${item.branches || 'N/A'}</td>
                        <td>${item.years_allowed || 'N/A'}</td>
                    `;
                case 'ib-tech':
                    return `
                        <td>${item.activity_name || 'N/A'}</td>
                        <td>${item.activity_type || 'N/A'}</td>
                        <td>${formatDateOnly(item.start_date) || 'N/A'}</td>
                        <td>${formatDateOnly(item.end_date) || 'N/A'}</td>
                        <td>${item.coordinator_details || 'N/A'}</td>
                        <td>${item.resource_person_details || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.conducted_departments || 'N/A'}</td>
                    `;
                case 'parents-meetings':
                    return `
                        <td>${item.purpose || 'N/A'}</td>
                        <td>${formatDateOnly(item.meeting_date) || 'N/A'}</td>
                        <td>${item.meeting_time || 'N/A'}</td>
                        <td>${item.venue || 'N/A'}</td>
                        <td>${item.coordinator_details || 'N/A'}</td>
                        <td>${item.parents_attended || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.conducted_departments || 'N/A'}</td>
                        <td>${item.years || 'N/A'}</td>
                    `;
                case 'rd-events':
                    return `
                        <td>${item.event_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.event_date) || 'N/A'}</td>
                        <td>${item.coordinator_details || 'N/A'}</td>
                        <td>${item.resource_person_details || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.brochure_path ? `<a href="/uploads/${item.brochure_path.replace(/^uploads[\\/]/, '')}" target="_blank" class="text-blue-600 hover:underline">View Brochure</a>` : 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                        <td>${item.years_allowed || 'N/A'}</td>
                    `;
                case 'fest-events':
                    return `
                        <td>${item.fest_name || 'N/A'}</td>
                        <td>${formatDateOnly(item.fest_date) || 'N/A'}</td>
                        <td>${item.fest_type || 'N/A'}</td>
                        <td>${item.fest_significance || 'N/A'}</td>
                        <td>${item.coordinator_details || 'N/A'}</td>
                        <td>${item.resource_person_details || 'N/A'}</td>
                        <td>${item.remarks || 'N/A'}</td>
                        <td>${item.students_participated || 'N/A'}</td>
                        <td>${item.brochure_path ? `<a href="/uploads/${item.brochure_path.replace(/^uploads[\\/]/, '')}" target="_blank" class="text-blue-600 hover:underline">View Brochure</a>` : 'N/A'}</td>
                        <td>${item.departments || 'N/A'}</td>
                        <td>${item.student_years || 'N/A'}</td>
                    `;
                default:
                    return '<td colspan="7">Data not available</td>';
            }
        }

        // Export PDF function for dashboard tables
        function exportPDF() {
            const pdf = new window.jspdf.jsPDF('l', 'pt', 'a4');
            const container = document.querySelector('.container.mx-auto.p-6.space-y-6');
            if (!container) {
                alert('No data to export!');
                return;
            }
            // Hide loading spinner if visible
            document.getElementById('loading').classList.add('hidden');

            // Use html2canvas to render the dashboard tables
            html2canvas(container, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pageWidth;
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                let position = 0;
                pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);

                // If content is longer than one page, add more pages
                if (pdfHeight > pageHeight) {
                    let remainingHeight = pdfHeight - pageHeight;
                    let pageCount = Math.ceil(pdfHeight / pageHeight);
                    for (let i = 1; i < pageCount; i++) {
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, -i * pageHeight, pdfWidth, pdfHeight);
                    }
                }

                pdf.save('department-profile-dashboard.pdf');
            });
        }
    </script>
</body>
</html>